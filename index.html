<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surveyor App</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <style>
        body {
            background-color: #061726;
            color: #bcc2c6;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            font-size: large;
        }
    </style>
</head>
<body>
    <div class="input">
        <h1>Input data</h1>
        <div>
            Point S:
            X <input type="number" step="0.01" id="input-sx" />
            Y <input type="number" step="0.01" id="input-sy" />
        </div><div>
            Point N:
            X <input type="number" step="0.01" id="input-nx" />
            Y <input type="number" step="0.01" id="input-ny" />
        </div><div>
            Angle |SNP|: <input type="number" step="0.01" id="input-a" />
        </div><div>
            Distance |NP|: <input type="number" step="0.01" id="input-d" />
        </div><div>
            <button id="execute">Calculate</button>
        </div>
    </div>
    <hr>
    <div class="output">
        <h1>Results</h1>
        <div>
            Delta SN:
            X <input type="text" id="output-dxsn" readonly />
            Y <input type="text" id="output-dysn" readonly />
        </div><div>
            Azimuth SN: <input type="text" id="output-asn" readonly />
        </div><div>
            Azimuth SP: <input type="text" id="output-asp" readonly />
        </div><div>
            Delta SP:
            X <input type="text" id="output-dxsp" readonly />
            Y <input type="text" id="output-dysp" readonly />
        </div><div>
            Point P:
            X <input type="text" id="output-px" readonly />
            Y <input type="text" id="output-py" readonly />
        </div>
    </div>
    <script>
        const executeButton = document.getElementById('execute');
        executeButton.addEventListener('click', calculate);

        function readNumber(id) {
            return parseFloat(document.getElementById(id).value, 10);
        }

        function writeResult(id, value) {
            document.getElementById(id).value = value;
        }

        function radToGra(rad) {
            return (rad * 200 / Math.PI + 400) % 400;
        }

        function graToRad(gra) {
            return gra / 200 * Math.PI;
        }

        function roundToPrecision(number, precision) {
            return number.toFixed(precision);
        }

        function calculate() {
            const config = {
                precision: {
                    coord: 6,
                    angle: 2,
                }
            }

            const input = {
                s: {x: readNumber('input-sx'), y: readNumber('input-sy')},
                n: {x: readNumber('input-nx'), y: readNumber('input-ny')},
                a: readNumber('input-a'),
                d: readNumber('input-d'),
            }

            const dxSN = input.n.x - input.s.x;
            const dySN = input.n.y - input.s.y;

            const angle = graToRad(input.a);
            const aziSN = Math.atan2(dySN, dxSN);
            const aziSP = aziSN + angle;

            const dxSP = input.d * Math.cos(aziSP);
            const dySP = input.d * Math.sin(aziSP);

            const p = {
                x: input.s.x + dxSP,
                y: input.s.y + dySP,
            }

            writeResult('output-dxsn', roundToPrecision(dxSN, config.precision.coord));
            writeResult('output-dysn', roundToPrecision(dySN, config.precision.coord));
            writeResult('output-dxsp', roundToPrecision(dxSP, config.precision.coord));
            writeResult('output-dysp', roundToPrecision(dySP, config.precision.coord));
            writeResult('output-asn', roundToPrecision(radToGra(aziSN), config.precision.angle));
            writeResult('output-asp', roundToPrecision(radToGra(aziSP), config.precision.angle));
            writeResult('output-px', roundToPrecision(p.x, config.precision.coord));
            writeResult('output-py', roundToPrecision(p.y, config.precision.coord));
        }
    </script>
</body>
</html>
